<element name="b-dropdown">
    <style>b-dropdown {
            position: relative;
        }
        b-dropdown > ul {
            display: none;
            position: absolute;
            /*left: 0;
            top: 100%;
            float: left;*/
            list-style-type: none;
            /* for IE 10 & 11 ... */
            list-style-image: url(data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7);
            padding: 0;
            margin: 0;
            z-index: 1000;
            /* minimum styling */
            background-color: white;
            border: 1px solid rgb(214, 214, 214);
        }
        b-dropdown ul > li > a {
            display: block;
            white-space: nowrap;
        }
        b-dropdown[open] ul {
            display: block;
        }
    </style>
    <script>
        function isChildOf(node, possibleParent) {
            var isChildren = false;
            while (node && !isChildren) {
                isChildren = node === possibleParent;
                node = node.parentNode;
            }
            return isChildren;
        }
        
        Bosonic.register({
            mixins: [Bosonic.A11y],

            hostAttributes: {
                role: 'menu'
            },

            keyBindings: {
                'up down': 'cycleFocus',
                'esc': 'echap',
                'enter': 'enter'
            },

            get open() {
                return this.hasAttribute('open');
            },

            get menu() {
                return this.querySelector('ul');
            },

            get button() {
                return this.querySelector('button');
            },

            createdCallback: function() {
                this.initialized = false;
                if(this.isUnderDocument()) {
                    this.init();
                }
            },

            attachedCallback: function() {
                if(!this.initialized) {
                    this.init();
                }
            },

            init: function() {
                Array.prototype.forEach.call(this.getFocusableElements(this.menu), function(focusable) {
                    focusable.setAttribute('role', 'menuitem');
                });

                this.clickOutsideListener = this.clickOutside.bind(this);
                var toggle = this.querySelector('button');
                if (toggle) {
                    var that = this;
                    toggle.addEventListener('click', function(e) {
                        that.toggle();
                    }, false)
                }
                this.initialized = true;
            },

            toggle: function() {
                this.open ? this.hide() : this.show();
            },

            show: function() {
                this.setAttribute('open', '');
                document.addEventListener('click', this.clickOutsideListener, true);
            },

            hide: function() {
                this.removeAttribute('open');
                document.removeEventListener('click', this.clickOutsideListener, true);
            },

            cycleFocus: function(e) {
                if (!this.open) {
                    return;
                }
                var currentlyFocused = this.menu.querySelector(':focus');
                if (!currentlyFocused) {
                    this.focusFirstItem();
                    return;
                }
                var focusables = this.getFocusableElements(this.menu),
                    currentlyFocusedIndex = Array.prototype.indexOf.call(focusables, currentlyFocused),
                    lastFocusableElementIndex = focusables.length - 1;
                if (this.keyMatchesEvent('down', e) && currentlyFocusedIndex < lastFocusableElementIndex) {
                    focusables[currentlyFocusedIndex + 1].focus();
                } else if (this.keyMatchesEvent('up', e) && currentlyFocusedIndex > 0) {
                    focusables[currentlyFocusedIndex - 1].focus();
                }
            },

            focusFirstItem: function() {
                var firstFocusableElement = this.getFirstFocusableElement(this.menu);
                if (firstFocusableElement) {
                    firstFocusableElement.focus();
                }
            },

            enter: function(e) {
                if (e.target === this.button) {
                    e.preventDefault();
                    this.show();
                    this.focusFirstItem();
                }
            },

            echap: function() {
                if (!this.open) {
                    return;
                }
                this.hide();
                this.button.focus();
            },

            clickOutside: function(e) {
                if (!isChildOf(e.target, this)) {
                    this.hide();
                }
            },

            isUnderDocument: function(domElement) {
                return domElement !== undefined && (domElement === document || isUnderDocument(domElement.parentNode));
            }
        });
    </script>
</element>